/* $linq Version 2.0.0 (by Kurtis Jones @ https://github.com/battousai999/js-linq) */
class LinqInternal{static convertToString(e){return null==e?null:e.toString()}static convertToNumber(e){return Linq.isNumber(e)?e:NaN}static isConstructorCompatibleSource(e){return Linq.isIterable(e)||Linq.isGenerator(e)||Linq.isFunction(e)||Linq.isLinq(e)}static isStringNullOrEmpty(e){return null==e||""===e}static isTypedArray(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}static isIndexedCollection(e){return Array.isArray(e)||Linq.isString(e)||LinqInternal.isTypedArray(e)}static isCollectionHavingLength(e){return LinqInternal.isIndexedCollection(e)}static isCollectionHavingSize(e){return e instanceof Set||e instanceof Map}static isCollectionHavingExplicitCardinality(e){return LinqInternal.isCollectionHavingLength(e)||LinqInternal.isCollectionHavingSize(e)}static getExplicitCardinality(e){return LinqInternal.isCollectionHavingLength(e)?e.length:LinqInternal.isCollectionHavingSize(e)?e.size:null}static isEmptyIterable(e){if(LinqInternal.isCollectionHavingExplicitCardinality(e))return 0===LinqInternal.getExplicitCardinality(e);return LinqInternal.getIterator(e).next().done}static validateRequiredFunction(e,n){if(null==e||!Linq.isFunction(e))throw new Error(n)}static validateOptionalFunction(e,n){if(null!=e&&!Linq.isFunction(e))throw new Error(n)}static getIterator(e){return Linq.isIterable(e)?e[Symbol.iterator]():new Error("Value is not an iterable.")}static firstBasedOperator(e,n,t,r){for(let t of e)if(null==n||n(t))return t;if(r)throw new Error("No first element was found in the collection.");return t}static singleBasedOperator(e,n,t,r){let i,l=!1;for(let t of e)if(null==n||n(t)){if(l)throw null==n?new Error("There was more than one element in the collection."):new Error("More than one element in the collection satisfied the predicate");i=t,l=!0}if(l)return i;if(r)throw null==n?new Error("There were no elements in the collection."):new Error("No single element in the collection satisfied the predicate.");return t()}static lastBasedOperator(e,n,t,r){if(LinqInternal.isIndexedCollection(e)&&LinqInternal.isCollectionHavingExplicitCardinality(e)){for(let t=LinqInternal.getExplicitCardinality(e)-1;t>=0;t--){let r=e[t];if(null==n||n(r))return r}}else{let t,r=!1;for(let i of e)(null==n||n(i))&&(t=i,r=!0);if(r)return t}if(r)throw new Error("No last element was found in the collection.");return t}static elementAtBasedOperator(e,n,t){if(!LinqInternal.isValidNumber(e,e=>e>=0))return t();let r=n();if(LinqInternal.isCollectionHavingExplicitCardinality(r)&&e>=LinqInternal.getExplicitCardinality(r))return t();if(LinqInternal.isIndexedCollection(r))return r[e];let i=0;for(let n of r){if(i===e)return n;i+=1}return t()}static normalizeComparerOrDefault(e){return null==e?Linq.strictComparer:Linq.normalizeComparer(e)}static ensureLinq(e){return Linq.isLinq(e)?e:new Linq(e)}static createDeferredSort(e,n,t,r=null){return{keySelector:e,comparer:n,isReverse:t,parent:r}}static performDeferredSort(e,n){let t=LinqInternal.buildSortChain(n),r=(e,n,t)=>{let i;return 0===(i=t.isReverse?t.comparer(t.keySelector(n),t.keySelector(e)):t.comparer(t.keySelector(e),t.keySelector(n)))?null==t.next?0:r(e,n,t.next):i};e.sort((e,n)=>r(e,n,t))}static buildSortChain(e){let n=(e,t)=>{let r={keySelector:e.keySelector,comparer:e.comparer,isReverse:e.isReverse,next:t};return null==e.parent?r:n(e.parent,r)};return n(e,null)}static orderByBasedOperator(e,n,t,r){LinqInternal.validateRequiredFunction(n),LinqInternal.validateOptionalFunction(t),null==t&&(t=Linq.generalComparer);let i=new Linq(e);return i[deferredSortSymbol]=LinqInternal.createDeferredSort(n,t,r),i}static thenByBasedOperator(e,n,t,r){LinqInternal.validateRequiredFunction(n),LinqInternal.validateOptionalFunction(t);let i=e[deferredSortSymbol];if(null==i)throw new Error(`${r?"ThenByDescending":"ThenBy"} can only be called following OrderBy, OrderByDescending, ThenBy, or ThenByDescending.`);null==t&&(t=Linq.generalComparer);let l=new Linq(e);return l[deferredSortSymbol]=LinqInternal.createDeferredSort(n,t,r,i),l}static getExtremeValue(e,n,t,r){return e.aggregate(null,(e,r)=>{let i=n(e),l=n(r);return t(l,i)?r:e},r)}static isValidNumber(e,n){return null!=e&&!isNaN(e)&&(null==n||n(e))}static minComparer(e,n){return e<n}static maxComparer(e,n){return e>n}}export class SimpleSet{constructor(e){this.set=new Set,this.comparer=e,this.usesComparer=null!=e,this.containsOnlyPrimitives=!0}static initialize(e,n){let t=new SimpleSet(n);for(let n of e)t.add(n);return t}add(e){this.containsOnlyPrimitives&&!Linq.isPrimitive(e)&&(this.containsOnlyPrimitives=!1),this.usesComparer?this.has(e)||this.set.add(e):!this.containsOnlyPrimitives&&this.has(e)||this.set.add(e)}remove(e){if(!this.usesComparer&&this.containsOnlyPrimitives)return this.set.delete(e);let n=this.usesComparer?this.comparer:Linq.strictComparer;for(let t of this.set.values())if(n(e,t))return this.set.delete(t),!0;return!1}has(e){if(!this.usesComparer&&this.containsOnlyPrimitives)return this.set.has(e);let n=this.usesComparer?this.comparer:Linq.strictComparer;for(let t of this.set.values())if(n(e,t))return!0;return!1}};var GeneratorFunction=function*(){}.constructor,deferredSortSymbol=Symbol("Provides private-like access for a deferredSort property.");export class Grouping{constructor(e,n){this.key=e,this.values=null==n?[]:Array.from(n)}};export class Linq{constructor(e){if(null==e&&(e=[]),!LinqInternal.isConstructorCompatibleSource(e))throw new Error("The 'source' is neither an iterable, a generator, nor a function that returns such.");this.source=e}static isFunction(e){return"function"==typeof e}static isArray(e){return Array.isArray(e)}static isString(e){return"string"==typeof e||e instanceof String}static isBoolean(e){return"boolean"==typeof e||e instanceof Boolean}static isNumber(e){return"number"==typeof e||e instanceof Number}static isSymbol(e){return"symbol"==typeof e}static isIterable(e){return null!=e&&"function"==typeof e[Symbol.iterator]}static isGenerator(e){return e instanceof GeneratorFunction}static isLinq(e){return e instanceof Linq}static isPrimitive(e){return Linq.isString(e)||Linq.isNumber(e)||Linq.isBoolean(e)||Linq.isSymbol(e)||null===e||void 0===e}static identity(e){return e}static tuple(e,n){return[e,n]}static strictComparer(e,n){return e===n}static defaultStringComparer(e,n){return Linq.caseSensitiveStringComparer(e,n)}static caseSensitiveStringComparer(e,n){let t=e=>null==e?null:LinqInternal.convertToString(e);return Linq.generalComparer(t(e),t(n))}static caseInsensitiveStringComparer(e,n){let t=e=>Linq.isString(e)?e.toLowerCase():e;return Linq.caseSensitiveStringComparer(t(e),t(n))}static defaultStringEqualityComparer(e,n){return Linq.caseSensitiveStringEqualityComparer(e,n)}static caseSensitiveStringEqualityComparer(e,n){return 0===Linq.caseSensitiveStringComparer(e,n)}static caseInsensitiveStringEqualityComparer(e,n){return 0===Linq.caseInsensitiveStringComparer(e,n)}static generalComparer(e,n){return null==e&&null==n?0:null==e?-1:null==n?1:e<n?-1:e>n?1:0}static normalizeComparer(e){return(n,t)=>{let r=e(n,t);return Linq.isBoolean(r)?r:0==r}}static createProjectionComparer(e,n=null){if(null==e)throw new Error("Invalid projection.");return null==n&&(n=((e,n)=>Linq.generalComparer(e,n))),(t,r)=>{let i=n(e(t),e(r));if(Linq.isBoolean(i))throw new Error("The given 'comparer' was an equality comparer instead of a comparer.");return i}}static createProjectionEqualityComparer(e,n=null){if(null==e)throw new Error("Invalid projection.");let t=LinqInternal.normalizeComparerOrDefault(n);return(n,r)=>t(e(n),e(r))}static from(e){return null==e||LinqInternal.isConstructorCompatibleSource(e)?new Linq(e):"undefined"!=typeof jQuery&&e instanceof jQuery?new Linq(e.get()):new Linq([e])}static range(e,n,t){if(!LinqInternal.isValidNumber(e))throw new Error("Invalid 'from' value.");if(!LinqInternal.isValidNumber(n))throw new Error("Invalid 'to' value.");if(LinqInternal.isValidNumber(t)||(t=1),0==t)throw new Error("Invalid 'step' value--cannot be zero.");let r;return r=t>0?(e,n)=>e<=n:(e,n)=>e>=n,new Linq(function*(){for(let i=e;r(i,n);i+=t)yield i})}static repeat(e,n){return LinqInternal.isValidNumber(n)||(n=1),new Linq(function*(){for(let t=0;t<n;t++)yield e})}static matches(e,n,t){if(null==n)throw new Error("Invalid 'pattern' value.");if(null==e)return new Linq;if(!Linq.isString(e))throw new Error("Parameter 'text' is not a string.");let r;null==t&&(t=""),t.includes("g")||(t+="g"),n instanceof RegExp?(!t.includes("i")&&n.ignoreCase&&(t+="i"),!t.includes("m")&&n.multiline&&(t+="m"),r=n.source):r=n;let i=new RegExp(r,t),l=e.match(i);return new Linq(null==l?[]:l)}static properties(e,n,t){if(null==e)return new Linq;LinqInternal.isStringNullOrEmpty(n)&&(n="key"),LinqInternal.isStringNullOrEmpty(t)&&(t="value");return new Linq(Object.keys(e).map(r=>{let i={};return i[n]=r,i[t]=e[r],i}))}static empty(){return new Linq([])}aggregate(e,n,t){LinqInternal.validateRequiredFunction(n,"Invalid operation."),LinqInternal.validateOptionalFunction(t,"Invalid result selector.");let r=LinqInternal.getIterator(this.toIterable()),i=null,l=null,a=()=>{let e=r.next();return i=e.value,!e.done};if(!a()){if(null==e)throw new Error("Cannot evaluate aggregation of an empty collection with no seed.");return null==t?e:t(e)}for(l=null==e?i:n(e,i);a();)l=n(l,i);return null==t?l:t(l)}all(e){LinqInternal.validateRequiredFunction(e,"Invalid predicate.");let n=this.toIterable();for(let t of n)if(!e(t))return!1;return!0}any(e){LinqInternal.validateOptionalFunction(e,"Invalid predicate.");let n=this.toIterable();if(null==e)return!LinqInternal.isEmptyIterable(n);for(let t of n)if(e(t))return!0;return!1}append(e){let n=this.toIterable();return new Linq(function*(){for(let e of n)yield e;yield e})}average(e){LinqInternal.validateOptionalFunction(e,"Invalid selector.");let n=this.toIterable(),t=0,r=1;for(let i of n){let n=null==e?i:e(i);if(null!=n){if(isNaN(n))throw new Error("Encountered an element that is not a number.");t+=(n-t)/r,r+=1}}return t}batch(e,n){if(LinqInternal.validateOptionalFunction(n,"Invalid result selector."),!LinqInternal.isValidNumber(e,e=>e>0))throw new Error("Invalid size.");let t=this.toIterable();return new Linq(function*(){let r=null,i=0;for(let l of t)null==r&&(r=[]),r[i]=null==n?l:n(l),(i+=1)==e&&(yield r,r=null,i=0);null!=r&&i>0&&(yield r)})}concat(e){if(null==e)return new Linq(this);var n=LinqInternal.ensureLinq(e);let t=this.toIterable(),r=n.toIterable();return new Linq(function*(){for(let e of t)yield e;for(let e of r)yield e})}contains(e,n){LinqInternal.validateOptionalFunction(n,"Invalid comparer.");let t=LinqInternal.normalizeComparerOrDefault(n),r=this.toIterable();for(let n of r)if(t(e,n))return!0;return!1}count(e){LinqInternal.validateOptionalFunction(e,"Invalid predicate.");let n=this.toIterable();if(null==e&&LinqInternal.isCollectionHavingExplicitCardinality(n))return LinqInternal.getExplicitCardinality(n);let t=0;for(let r of n)(null==e||e(r))&&(t+=1);return t}defaultIfEmpty(e){let n=this.toIterable();return LinqInternal.isEmptyIterable(n)?new Linq([e]):new Linq(this)}distinct(e){return this.distinctBy(Linq.identity,e)}distinctBy(e,n){return LinqInternal.validateRequiredFunction(e,"Invalid key selector."),LinqInternal.validateOptionalFunction(n,"Invalid comparer."),this.groupBy(e,null,n).select(e=>e.values[0])}elementAt(e){return LinqInternal.elementAtBasedOperator(e,()=>this.toIterable(),()=>{throw new Error("Invalid index.")})}elementAtOrDefault(e,n){return LinqInternal.elementAtBasedOperator(e,()=>this.toIterable(),()=>n)}equiZip(e,n){LinqInternal.validateOptionalFunction(n,"Invalid result selector."),null==n&&(n=Linq.tuple);let t=LinqInternal.ensureLinq(e),r=this.toIterable(),i=t.toIterable();if(LinqInternal.isCollectionHavingExplicitCardinality(r)&&LinqInternal.isCollectionHavingExplicitCardinality(i)&&LinqInternal.getExplicitCardinality(r)!==LinqInternal.getExplicitCardinality(i))throw new Error("The two collections being equi-zipped are not of equal lengths.");return new Linq(function*(){let e=LinqInternal.getIterator(r),t=LinqInternal.getIterator(i),l=e.next(),a=t.next();for(;!l.done;){if(a.done)throw new Error("Second collection is too short.");yield n(l.value,a.value),l=e.next(),a=t.next()}if(!a.done)throw new Error("First collection is too short.")})}except(e,n){LinqInternal.validateOptionalFunction(n,"Invalid comparer.");let t=null==n?null:Linq.normalizeComparer(n),r=LinqInternal.ensureLinq(e),i=this.toIterable(),l=r.toIterable(),a=SimpleSet.initialize(l,t);return new Linq(function*(){for(let e of i)a.has(e)||(a.add(e),yield e)})}first(e){LinqInternal.validateOptionalFunction(e,"Invalid predicate.");let n=this.toIterable();return LinqInternal.firstBasedOperator(n,e,null,!0)}firstOrDefault(e,n){LinqInternal.validateOptionalFunction(e,"Invalid predicate.");let t=this.toIterable();return LinqInternal.firstBasedOperator(t,e,n,!1)}foreach(e){LinqInternal.validateRequiredFunction(e,"Invalid action.");let n=this.toIterable(),t=0;for(let r of n)e(r,t),t+=1}groupBy(e,n,t){LinqInternal.validateRequiredFunction(e,"Invalid key selector."),LinqInternal.validateOptionalFunction(n,"Invalid element selector."),LinqInternal.validateOptionalFunction(t,"Invalid key comparer.");let r=LinqInternal.normalizeComparerOrDefault(t),i=this.toIterable(),l=[],a=new Linq(l);for(let t of i){let i=e(t),o=null==n?t:n(t),u=a.firstOrDefault(e=>r(e.key,i),null);null==u?l.push(new Grouping(i,[o])):u.values.push(o)}return a}groupJoin(e,n,t,r,i){if(null==e)throw new Error("Invalid inner collection.");LinqInternal.validateRequiredFunction(n,"Invalid outer key selector."),LinqInternal.validateRequiredFunction(t,"Invalid inner key selector."),LinqInternal.validateRequiredFunction(r,"Invalid result selector."),LinqInternal.validateOptionalFunction(i,"Invalid key comparer.");let l=LinqInternal.normalizeComparerOrDefault(i),a=LinqInternal.ensureLinq(e),o=this.toIterable(),u=a.groupBy(t,null,i),s=[];for(let e of o){let t=n(e),i=u.firstOrDefault(e=>l(e.key,t));s.push(r(e,null==i?[]:i.values))}return new Linq(s)}index(e){if(null==e&&(e=0),isNaN(e))throw new Error("Invalid startIndex.");return this.select((n,t)=>({key:e+t,value:n}))}indexOf(e){LinqInternal.validateRequiredFunction(e,"Invalid predicate.");let n=this.toIterable(),t=0;for(let r of n){if(e(r))return t;t+=1}return-1}indexOfElement(e,n){LinqInternal.validateOptionalFunction(n,"Invalid comparer.");let t=LinqInternal.normalizeComparerOrDefault(n),r=this.toIterable(),i=0;for(let n of r){if(t(e,n))return i;i+=1}return-1}intersect(e,n){LinqInternal.validateOptionalFunction(n,"Invalid comparer.");let t=LinqInternal.ensureLinq(e),r=null==n?null:Linq.normalizeComparer(n),i=this.toIterable(),l=t.toIterable(),a=SimpleSet.initialize(l,r);return new Linq(function*(){for(let e of i)a.remove(e)&&(yield e)})}join(e,n,t,r,i){if(null==e)throw new Error("Invalid inner collection.");LinqInternal.validateRequiredFunction(n,"Invalid outer key selector."),LinqInternal.validateRequiredFunction(t,"Invalid inner key selector."),LinqInternal.validateRequiredFunction(r,"Invalid result selector."),LinqInternal.validateOptionalFunction(i,"Invalid key comparer.");let l=LinqInternal.ensureLinq(e),a=LinqInternal.normalizeComparerOrDefault(i),o=l.groupBy(t,null,a),u=this.toIterable();return new Linq(function*(){for(let e of u){let t=n(e),i=o.firstOrDefault(e=>a(e.key,t));if(null!=i&&i.values.length>0)for(let n of i.values)yield r(e,n)}})}last(e){LinqInternal.validateOptionalFunction(e,"Invalid predicate.");let n=this.toIterable();return LinqInternal.lastBasedOperator(n,e,null,!0)}lastIndexOf(e){LinqInternal.validateRequiredFunction(e,"Invalid predicate.");let n=this.index().where(n=>e(n.value)).reverse().firstOrDefault();return null==n?-1:n.key}lastIndexOfElement(e,n){LinqInternal.validateOptionalFunction(n,"Invalid comparer.");let t=LinqInternal.normalizeComparerOrDefault(n);return this.lastIndexOf(n=>t(n,e))}lastOrDefault(e,n){LinqInternal.validateOptionalFunction(e,"Invalid predicate.");let t=this.toIterable();return LinqInternal.lastBasedOperator(t,e,n,!1)}min(e){LinqInternal.validateOptionalFunction(e,"Invalid selector.");let n=this.toIterable();if(LinqInternal.isEmptyIterable(n))throw new Error("No minimum element.");return null==e&&(e=Linq.identity),LinqInternal.getExtremeValue(this,e,LinqInternal.minComparer,e)}minBy(e){LinqInternal.validateRequiredFunction(e,"Invalid selector.");let n=this.toIterable();if(LinqInternal.isEmptyIterable(n))throw new Error("No minimum element.");return LinqInternal.getExtremeValue(this,e,LinqInternal.minComparer,Linq.identity)}max(e){LinqInternal.validateOptionalFunction(e,"Invalid selector.");let n=this.toIterable();if(LinqInternal.isEmptyIterable(n))throw new Error("No maximum element.");return null==e&&(e=Linq.identity),LinqInternal.getExtremeValue(this,e,LinqInternal.maxComparer,e)}maxBy(e){LinqInternal.validateRequiredFunction(e,"Invalid selector.");let n=this.toIterable();if(LinqInternal.isEmptyIterable(n))throw new Error("No maximum element.");return LinqInternal.getExtremeValue(this,e,LinqInternal.maxComparer,Linq.identity)}orderBy(e,n){return LinqInternal.orderByBasedOperator(this,e,n,!1)}orderByDescending(e,n){return LinqInternal.orderByBasedOperator(this,e,n,!0)}pad(e,n){return this.padWith(e,()=>n)}padWith(e,n){if(!LinqInternal.isValidNumber(e))throw new Error("Invalid width.");LinqInternal.validateRequiredFunction(n,"Invalid padding selector.");let t=this.toIterable();return new Linq(function*(){let r=0;for(let e of t)yield e,r+=1;for(;r<e;)yield n(r),r+=1})}pipe(e){LinqInternal.validateRequiredFunction(e,"Invalid action.");let n=this.toIterable(),t=0;for(let r of n)e(r,t),t+=1;return new Linq(this.source)}prepend(e){let n=this.toIterable();return new Linq(function*(){yield e;for(let e of n)yield e})}prescan(e,n){LinqInternal.validateRequiredFunction(e,"Invalid operation.");let t=this.toIterable(),r=LinqInternal.getIterator(t);return new Linq(function*(){let t=n,i=r.next();for(;!i.done;){yield t;let{value:n}=i;(i=r.next()).done||(t=e(t,n))}})}reverse(){let e=this.toIterable();return LinqInternal.isIndexedCollection(e)&&LinqInternal.isCollectionHavingLength(e)||(e=Array.from(e)),new Linq(function*(){for(let n=e.length-1;n>=0;n--)yield e[n]})}scan(e,n){LinqInternal.validateRequiredFunction(e,"Invalid operation.");let t=void 0===n?this:this.prepend(n);return new Linq(function*(){let n=t.toIterable(),r=LinqInternal.getIterator(n),i=r.next();if(i.done)return;let l=i.value;for(yield l,i=r.next();!i.done;)yield l=e(l,i.value),i=r.next()})}select(e){LinqInternal.validateRequiredFunction(e,"Invalid selector.");let n=this.toIterable(),t=0;return new Linq(function*(){for(let r of n)yield e(r,t),t+=1})}selectMany(e,n){LinqInternal.validateRequiredFunction(e,"Invalid collection selector."),LinqInternal.validateOptionalFunction(n,"Invalid result selector.");var t=this.toIterable();return new Linq(function*(){let r=0;for(let i of t){let t=e(i,r);if(r+=1,null==t)continue;let l=LinqInternal.ensureLinq(t).toIterable();for(let e of l)yield null==n?e:n(e,i)}})}sequenceEqual(e,n){if(LinqInternal.validateOptionalFunction(n,"Invalid comparer."),null==e)return!1;let t=LinqInternal.normalizeComparerOrDefault(n),r=this.toIterable(),i=LinqInternal.ensureLinq(e).toIterable(),l=LinqInternal.getExplicitCardinality(r),a=LinqInternal.getExplicitCardinality(i);if(null!=l&&null!=a&&l!==a)return!1;let o=LinqInternal.getIterator(r),u=LinqInternal.getIterator(i),s=o.next(),c=u.next();for(;!s.done&&!c.done;){if(!t(s.value,c.value))return!1;s=o.next(),c=u.next()}return!(!s.done||!c.done)}sequenceEquivalent(e,n){if(LinqInternal.validateOptionalFunction(n,"Invalid comparer."),null==e)return!1;let t=LinqInternal.normalizeComparerOrDefault(n),r=LinqInternal.ensureLinq(e),i=this.toIterable(),l=r.toIterable(),a=LinqInternal.getExplicitCardinality(i),o=LinqInternal.getExplicitCardinality(l);if(null!=a&&null!=o&&a!==o)return!1;let u=this.toLookup(Linq.identity,n),s=r.toLookup(Linq.identity,n);return u.count()===s.count()&&u.all(e=>{let n=s.firstOrDefault(n=>t(n.key,e.key));return null!=n&&e.values.length===n.values.length})}single(e){LinqInternal.validateOptionalFunction(e,"Invalid predicate.");let n=this.toIterable();return LinqInternal.singleBasedOperator(n,e,null,!0)}singleOrDefault(e,n){LinqInternal.validateOptionalFunction(e,"Invalid predicate.");let t=this.toIterable();return LinqInternal.singleBasedOperator(t,e,()=>n,!1)}singleOrFallback(e){LinqInternal.validateRequiredFunction(e,"Invalid fallback function.");let n=this.toIterable();return LinqInternal.singleBasedOperator(n,null,e,!1)}skip(e){if(!LinqInternal.isValidNumber(e))throw new Error("Invalid count.");let n=this.toIterable();return new Linq(function*(){let t=1;for(let r of n)t>e&&(yield r),t+=1})}skipUntil(e){return LinqInternal.validateRequiredFunction(e,"Invalid predicate."),this.skipWhile(n=>!e(n))}skipWhile(e){LinqInternal.validateRequiredFunction(e,"Invalid predicate.");let n=this.toIterable();return new Linq(function*(){let t=!0;for(let r of n)t?e(r)||(t=!1,yield r):yield r})}sum(e){LinqInternal.validateOptionalFunction(e,"Invalid selector.");return this.aggregate(0,(n,t)=>n+(n=>{let t=null==e?n:e(n);if(null==t)t=0;else if(isNaN(t))throw new Error("Encountered an element that is not a number.");return t})(t))}take(e){if(!LinqInternal.isValidNumber(e))throw new Error("Invalid count.");let n=this.toIterable();return new Linq(function*(){let t=0;for(let r of n){if(t>=e)return;yield r,t+=1}})}takeEvery(e){if(!LinqInternal.isValidNumber(e,e=>e>0))throw new Error("Invalid step.");return this.where((n,t)=>t%e==0)}takeLast(e){if(!LinqInternal.isValidNumber(e,e=>e>=0))throw new Error("Invalid count");if(0===e)return Linq.empty();let n=this.toIterable();if(LinqInternal.isCollectionHavingExplicitCardinality(n)){let t=LinqInternal.getExplicitCardinality(n);if(null!=t)return this.skip(t-e)}return new Linq(this.aggregate([],(n,t)=>(n.length===e&&n.shift(),n.push(t),n)))}takeUntil(e){return LinqInternal.validateRequiredFunction(e,"Invalid predicate."),this.takeWhile(n=>!e(n))}takeWhile(e){LinqInternal.validateRequiredFunction(e,"Invalid predicate.");var n=this.toIterable();return new Linq(function*(){for(let t of n){if(!e(t))return;yield t}})}thenBy(e,n){return LinqInternal.thenByBasedOperator(this,e,n,!1)}thenByDescending(e,n){return LinqInternal.thenByBasedOperator(this,e,n,!0)}toArray(){return Array.from(this.toIterable())}toDelimitedString(e){return LinqInternal.isEmptyIterable(this.toIterable())?"":(null==e&&(e=","),this.aggregate(null,(n,t)=>`${n}${e}${t}`))}toDictionary(e,n){LinqInternal.validateRequiredFunction(e,"Invalid key selector."),LinqInternal.validateOptionalFunction(n,"Invalid element selector.");let t=null==n?Linq.identity:n,r=this.toIterable(),i={};for(let n of r){let r=e(n);if(r in i)throw new Error("Duplicate key in collection.");i[r]=t(n)}return i}toIterable(){let e=n=>{if(Linq.isLinq(n))return e(n.source);if(Linq.isIterable(n))return n;if(Linq.isGenerator(n))return n();if(Linq.isFunction(n))return e(n());throw new Error("Could not return an iterable because the 'source' was not valid.")},n=e(this.source),t=this[deferredSortSymbol];if(null==t)return n;return function*(){let e=Array.from(n);LinqInternal.performDeferredSort(e,t);for(let n of e)yield n}()}toLookup(e,n){LinqInternal.validateRequiredFunction(e,"Invalid key selector."),LinqInternal.validateOptionalFunction(n,"Invalid key comparer.");let t=LinqInternal.normalizeComparerOrDefault(n),r=this.toIterable(),i=[],l=new Linq(i);for(let n of r){let r=e(n),a=l.firstOrDefault(e=>t(e.key,r));null==a&&(a={key:r,values:[]},i.push(a)),a.values.push(n)}return l}union(e,n){LinqInternal.validateOptionalFunction(n,"Invalid comparer.");let t=null==n?null:Linq.normalizeComparer(n),r=LinqInternal.ensureLinq(e),i=this.toIterable(),l=r.toIterable(),a=new SimpleSet(t);return new Linq(function*(){for(let e of i)a.has(e)||(a.add(e),yield e);for(let e of l)a.has(e)||(a.add(e),yield e)})}where(e){LinqInternal.validateRequiredFunction(e,"Invalid predicate.");let n=this.toIterable();return new Linq(function*(){let t=0;for(let r of n)e(r,t)&&(yield r),t+=1})}zip(e,n){LinqInternal.validateOptionalFunction(n,"Invalid result selector."),null==n&&(n=Linq.tuple);let t=LinqInternal.ensureLinq(e),r=LinqInternal.getIterator(this.toIterable()),i=LinqInternal.getIterator(t.toIterable());return new Linq(function*(){let e=r.next(),t=i.next();for(;!e.done&&!t.done;)yield n(e.value,t.value),e=r.next(),t=i.next()})}zipLongest(e,n,t,r){LinqInternal.validateOptionalFunction(r,"Invalid result selector."),null==r&&(r=Linq.tuple);let i=LinqInternal.ensureLinq(e),l=LinqInternal.getIterator(this.toIterable()),a=LinqInternal.getIterator(i.toIterable());return new Linq(function*(){let e=l.next(),i=a.next();for(;!e.done||!i.done;){let o=e.done?n:e.value,u=i.done?t:i.value;yield r(o,u),e.done||(e=l.next()),i.done||(i=a.next())}})}};